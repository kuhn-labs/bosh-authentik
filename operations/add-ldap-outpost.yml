# Use this ops file to add an LDAP outpost
#
# Prerequisites:
# 1. Deploy authentik core first (server + worker)
# 2. Create an outpost in the authentik UI and get the API token
#
# Usage:
#   bosh deploy manifests/authentik.yml \
#     -o operations/add-ldap-outpost.yml \
#     -v authentik_ldap_outpost_token=<token-from-authentik-ui>

- type: replace
  path: /instance_groups/name=authentik/jobs/-
  value:
    name: authentik-ldap-outpost
    release: authentik
    consumes:
      authentik: {from: authentik}
    properties:
      authentik:
        token: ((authentik_ldap_outpost_token))

- type: replace
  path: /variables?/-
  value:
    name: authentik_ldap_outpost_token
    type: value
